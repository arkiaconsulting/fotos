@using Fotos.Client.Features.PhotoFolders

@inject ListPhotos ListPhotos
@inject RemovePhoto RemovePhoto

<div id="thumbnails">
    @foreach (var thumbnail in _thumbnails)
    {
        <div class="thumbnail">
            <button class="view" onclick="@(() => ViewPhoto(thumbnail))">
                <img src="img/new.png" style="background-color:black" width="50" height="50" />
            </button>
            <button class="remove btn btn-error" onclick="@(() => RemoveAPhoto(thumbnail))">X</button>
        </div>
    }
</div>

@if(_photo is not null)
{
    <div id="photo">
        <img src="img/new.png" width="500" height="300"/>
        <button class="dismiss btn btn-error" onclick="@(() => DismissPhoto(_photo!.Value))">X</button>
    </div>
}
@code {
    [Parameter]
    public Guid FolderId { get; set; }

    [Parameter]
    public Guid AlbumId { get; set; }

    private List<Photo> _thumbnails = [];
    private Photo? _photo = default!;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _thumbnails = (await ListPhotos(FolderId, AlbumId)).ToList();

            StateHasChanged();
        }
    }

    public void AddPhoto(Photo photo)
    {
        _thumbnails.Add(photo);

        StateHasChanged();
    }

    private async Task RemoveAPhoto(Photo photo)
    {
        await RemovePhoto(photo.FolderId, photo.AlbumId, photo.Id);
        _thumbnails.Remove(photo);

        StateHasChanged();
    }

    private async Task ViewPhoto(Photo photo)
    {
        _photo = photo;

        await Task.CompletedTask;

        StateHasChanged();
    }

    private void DismissPhoto(Photo photo)
    {
        _photo = null;

        StateHasChanged();
    }
}
